(()=>{"use strict";var t={488:(t,e,s)=>{var i=s(294),n=s(935),a=s(512);let h;!function(t){t[t.select=0]="select",t[t.curve=1]="curve",t[t.line=2]="line",t[t.rect=3]="rect",t[t.circle=4]="circle"}(h||(h={}));const r="Shift",o=function(t){return i.createElement("svg",{t:"1609052441661",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"50"},i.createElement("path",{d:"M35.500095 597.784331c1.110532-0.502882 2.224057-0.997782 3.342571-1.483702-4.368291 1.900775-0.384146 0.182594 0.438027-0.14867 2.386695-0.959867 4.802326-1.846895 7.221948-2.71297 5.508756-1.97062 11.114297-3.671839 16.749771-5.24135 11.592234-3.227826 23.405977-5.639465 35.278587-7.569176 2.938469-0.477938 5.885918-0.902993 8.835362-1.311086-4.309422 0.597672 0.666519-0.06286 1.290133-0.13969 1.485698-0.182594 2.973391-0.348226 4.462082-0.51286 6.434698-0.716408 12.890349-1.23725 19.352985-1.636363a357.481442 357.481442 0 0 1 36.192557-0.388137c5.432924 0.216519 10.858864 0.611641 16.270835 1.140465 1.329046 0.129712 9.516847 1.152439 4.35532 0.449002 2.864633 0.390133 5.716295 0.863082 8.560972 1.375942 4.542903 0.820177 9.042901 1.856873 13.494007 3.079156 2.234035 0.612638 4.469067 1.254212 6.679155 1.945675 1.166407 0.365188 2.308868 0.803215 3.451329 1.238248-4.666628-1.782039 0.409091 0.255432 1.349001 0.719401 4.316406 2.133258 8.348444 4.811306 12.225826 7.650995 3.380486 2.475498-3.000331-2.39368 0.278382 0.218514 0.942904 0.752328 1.866851 1.527605 2.790797 2.303879 2.154212 1.804988 4.245564 3.68481 6.324941 5.575607 7.17605 6.522503 14.029817 13.406203 21.644891 19.429815 8.726604 6.903656 17.975048 12.905316 28.935686 15.596334 12.553099 3.083147 25.149102 1.188359 36.860073-3.862415 20.805756-8.974054 36.420051-28.591451 51.86572-44.446211 3.844455-3.945231 7.767735-7.809642 11.833698-11.525383a144.845059 144.845059 0 0 1 5.944787-5.114632c3.371506-2.761861-2.995342 2.212083 0.44102-0.336253 1.297117-0.960864 2.638136-1.857871 3.988135-2.73991 1.929711-1.261197 3.95022-2.369733 6.007647-3.400442 3.663857-1.833924-4.428158 1.715188 0.237473-0.130709 1.365964-0.5398 2.745897-1.042682 4.125829-1.545565 5.585585-2.032482 11.31086-3.661861 17.109971-4.958978 2.480487-0.554767 4.986916-0.991796 7.499331-1.38592-4.936029 0.772283-0.763303 0.10776 0.226497-0.001995 1.19235-0.132705 2.389689-0.225499 3.586029-0.317295 4.967958-0.383148 9.959863-0.322284 14.925825 0.037916 1.105543 0.08082 2.20909 0.199556 3.310642 0.317295 3.963191 0.426053-4.212637-0.633592-0.298337-0.030932 2.139245 0.32827 4.259533 0.764301 6.37084 1.233259 4.506983 1.003769 8.920174 2.391684 13.251546 3.985143 0.993791 0.366186 1.977604 0.76031 2.961418 1.153436 3.566074 1.428824-3.787582-1.650332-0.272395-0.096785 1.941684 0.859091 3.849444 1.794013 5.746229 2.74889 4.142792 2.086363 8.154875 4.429156 12.08913 6.882702 3.689799 2.300886 7.274831 4.766406 10.809973 7.296782a260.941018 260.941018 0 0 1 5.311195 3.921284c0.800221 0.60266 3.915298 3.015298-0.01796-0.032926 1.173392 0.90898 2.335808 1.831928 3.498224 2.754876 14.846002 11.793786 28.89777 24.551431 43.861511 36.200539 24.738016 19.258196 51.715055 34.80963 82.725131 41.018829 48.853416 9.784253 98.087984-4.243568 143.553929-21.651875 74.075356-28.361961 144.598607-66.189883 214.210883-103.918026 8.357424-4.530929 10.954652-15.8817 6.263079-23.889901-4.92206-8.402325-15.520503-10.800993-23.889901-6.265075-48.235788 26.143891-96.832774 51.745986-146.574216 74.926464a1260.898456 1260.898456 0 0 1-28.707194 12.947223c-2.15521 0.938913-4.316406 1.868846-6.4786 2.792793-0.910975 0.390133-4.677603 1.983591-0.06286 0.03592a839.474138 839.474138 0 0 1-16.282809 6.667181c-14.684362 5.841017-29.565287 11.217068-44.695657 15.788907-12.082146 3.649888-24.35387 6.720064-36.797213 8.857313-1.323059 0.226497-2.648114 0.437029-3.975164 0.640576-1.639356 0.251441-6.968511 0.949889 0.108758 0.016963-2.704988 0.356208-5.419953 0.646563-8.136914 0.891019-4.896118 0.439024-9.810195 0.659534-14.726269 0.676497-4.576827 0.015965-9.153655-0.191574-13.712522-0.591685-2.057427-0.180599-10.062634-1.214301-2.168181-0.145677a146.065347 146.065347 0 0 1-6.633256-1.065631c-8.748555-1.596452-17.342454-4.023058-25.71684-6.997447-1.235254-0.438026-8.300551-3.305653-3.364522-1.212306-2.118292-0.897006-4.201661-1.87184-6.274055-2.868624-4.471062-2.151219-8.810417-4.567847-13.06995-7.108201-3.929267-2.344788-7.752768-4.864189-11.519397-7.45942a260.26951 260.26951 0 0 1-5.594565-3.985142 290.500318 290.500318 0 0 1-2.763857-2.046452c-0.822173-0.613636-5.092681-3.894344-1.020731-0.746341-14.999661-11.602212-29.048435-24.368836-43.863506-36.200538-16.10221-12.861413-32.556638-24.026597-51.594324-32.05176-18.104759-7.632037-38.571269-10.188355-58.013057-7.583146-12.451325 1.66929-24.297994 4.616739-35.993998 9.242458-11.650106 4.606761-21.359525 11.803764-30.639898 20.152208-8.656759 7.788688-16.523274 16.429483-24.611297 24.792894-3.846451 3.97716-7.755762 7.892458-11.795782 11.674053a160.915341 160.915341 0 0 1-5.91186 5.242348c-0.969844 0.822173-1.965631 1.614412-2.961418 2.405653 3.766628-2.991351-0.631596 0.356208-1.411862 0.89501-1.912749 1.321064-3.9143 2.503436-5.954764 3.611972-0.974833 0.528825-1.981596 0.994789-2.987361 1.458758 4.559865-2.099334 1.254212-0.5847 0.17561-0.217517-1.426829 0.48592-8.683699 1.78603-3.103103 1.052661-2.507427 0.330266-5.044787 0.306319-7.560196 0.123725-3.819511-0.275388 4.26951 0.732372 0.542793 0.030931-1.006762-0.188581-1.994567-0.460975-2.981373-0.731374-0.984811-0.270399-1.947671-0.614634-2.910531-0.959867-3.523169-1.259201 3.80155 1.740132 0.392129 0.154656-1.895786-0.88204-3.708757-1.938691-5.489798-3.029267-0.911973-0.558758-1.796008-1.159423-2.680044-1.760088-0.897006-0.607649-5.010863-3.721728-0.858092-0.506873-16.493341-12.769618-29.756861-29.213069-48.201864-39.516169-15.924605-8.896227-34.606083-11.89556-52.456408-14.12261-18.601655-2.320842-37.4777-2.423613-56.172148-1.413858-39.549096 2.135254-79.834555 9.181592-116.08199 25.610078-8.66973 3.929267-10.696226 16.323718-6.263079 23.889901 5.175497 8.833366 15.221169 10.193344 23.890898 6.263079z",stroke:t.color,strokeWidth:5*t.weight,fill:t.color}))};var c=s(163);const l=c.ZP.div`
  ${t=>`\n      width: 50%;\n      height: ${t.weight}px;\n      max-height: 30px;\n      background-color: ${t.color};\n    `}
`,d=t=>`\n  width: 20px;\n  height: 20px;\n  border: ${t.weight}px solid ${t.color};\n  display: inline-block;\n  vertical-align: text-top;\n  background: ${t.fill?t.color:"transparent"};\n`,p=c.ZP.div`
  ${t=>d(t)}
`,u=c.ZP.div`
  ${t=>`\n      ${d(t)}\n      border-radius: 50%;\n    `}}
`;var x=s(379),v=s.n(x),y=s(728);v()(y.Z,{insert:"head",singleton:!1}),y.Z.locals;class g extends i.Component{constructor(t){super(t),this.state={color:"#000000",select:-1,selectChild:"",weight:1,brush:""},this.ActiveClass="active",this.brushs=[{key:"b_1",brush:h.curve,child:o},{key:"b_2",brush:h.line,child:l},{key:"b_3",brush:h.rect,child:p},{key:"b_4",brush:h.rect,fill:"true",child:p},{key:"b_5",brush:h.circle,child:u},{key:"b_6",brush:h.circle,fill:"true",child:u}],this.onChangeColor=({target:t})=>{const e={color:t.value};this.setState(e),this.props.brushChange(e)},this.onClickShape=({key:t,brush:e,fill:s=!1})=>{this.state.selectChild===t&&(e=null,t=-1),this.setState({selectChild:t,brush:e}),this.props.brushChange({brush:e,fill:s})},this.onClickSelect=()=>{this.setState({selectChild:"",brush:h.select}),this.props.brushChange({brush:h.select,fill:!1})},this.onClickParent=({currentTarget:t})=>{const e=t.getAttribute("data-index"),s=this.state.select;this.setState({select:s===e?-1:e})},this.onClickWeight=({currentTarget:t})=>{const e=t.getAttribute("data-index"),s=t.getAttribute("data-weight"),i=this.state.selectChild;this.props.brushChange({lineWidth:s}),this.setState({selectChild:i===e?"":e,weight:s})}}render(){return i.createElement("div",{className:"toolbar"},i.createElement("ul",null,i.createElement("li",{className:1==this.state.select?this.ActiveClass:""},i.createElement("div",{"data-index":"1",className:"item",onClick:this.onClickParent},"画笔"),i.createElement("div",{className:"item-categories"},i.createElement("div",{onClick:t=>t.stopPropagation()},i.createElement("input",{type:"color",value:this.state.color,onChange:this.onChangeColor})),[1,2,5].map(((t,e)=>i.createElement("div",{key:e,"data-index":`c_${e}`,"data-weight":t,onClick:this.onClickWeight,className:this.state.selectChild==`c_${e}`?this.ActiveClass:""},i.createElement(l,{weight:t,color:this.state.color})))))),i.createElement("li",{className:2==this.state.select?this.ActiveClass:""},i.createElement("div",{"data-index":"2",className:"item",onClick:this.onClickParent},"形状"),i.createElement("div",{className:"item-categories"},this.brushs.map(((t,e)=>i.createElement("div",{key:t.key,"data-index":t.key,"data-brush":t.brush,onClick:()=>this.onClickShape(t),className:this.state.selectChild==t.key?this.ActiveClass:""},i.createElement(t.child,{weight:this.state.weight,color:this.state.color,fill:t.fill})))))),i.createElement("li",{className:4==this.state.select?this.ActiveClass:""},i.createElement("div",{"data-index":"4",className:"item",onClick:this.onClickParent},"工具"),i.createElement("div",{className:"item-categories"},i.createElement("div",null,i.createElement("a",{download:!0,onClick:this.props.download},"下载")),i.createElement("div",{onClick:this.onClickSelect},"选区"))),i.createElement("li",{className:3==this.state.select?this.ActiveClass:""},i.createElement("div",{"data-index":"3",className:"item",onClick:this.props.onCancel},"撤销"))))}}const m=g;var w=s(661);function b(){return(b=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t}).apply(this,arguments)}v()(w.Z,{insert:"head",singleton:!1}),w.Z.locals;class C extends i.Component{constructor(t){super(t),this.points={sx:0,sy:0,mx:0,my:0,ex:0,ey:0,px:0,py:0},this.moving=!1,this.hasSelect=!1,this.canDraw=!1,this.ctx=void 0,this.pencil=void 0,this.draw=(t,e,{})=>{},this.canvasRef=void 0,this.canvasData=[],this.historys=[],this.keyboard="",this.onCancel=()=>{let{history:t}=this.prevHistory;const e=this.canvasData[1];for(;t&&t==e;)t=this.prevHistory.history;return t&&this.ctx.putImageData(t,0,0),t},this.onCancelSelect=(t,e)=>{if(this.hasSelect&&!this.withinSelectScope(t,e)){this.hasSelect=!1;const t=this.onCancel();t&&this.historys.push({name:"保存撤销后的记录",history:t})}},this.onDownload=({currentTarget:t})=>{const e=this.canvas.toDataURL();t.setAttribute("href",e)},this.onBrushChange=(t={})=>{this.pencil.setOptions(t)},this.onMouseUp=({pageX:t,pageY:e})=>{if(this.canDraw=!1,this.moving){const t=this.getCanvasData();this.historys.push({name:"结束绘画",history:t}),this.moving=!1}const{sx:s,sy:i}=this.points;t<s?(this.points.sx=t,this.points.sy=e,this.points.ex=s,this.points.ey=i):(this.points.ex=t,this.points.ey=e),this.saveHistory()},this.onMouseDown=({pageX:t,pageY:e})=>{if(this.canDraw=!0,this.points.px=t,this.points.py=e,this.withinSelectScope(t,e)){const{sx:t,sy:e,ex:s,ey:i}=this.points,n=s-t,a=i-e,h=this.ctx.getImageData(t+1,e+1,n-2,a-2);return this.canvasData[2]=h,this.moving=!0,this.ctx.clearRect(t-1,e-1,n+2,a+2),void(this.canvasData[1]=this.getCanvasData())}this.onCancelSelect(t,e),this.points.sx=t,this.points.sy=e,this.initBrushSetting(),this.canvasData[0]=this.getCanvasData(),this.historys.length<=0&&this.historys.push({name:"第一次保存",history:this.canvasData[0]})},this.onMouseMove=({pageX:t,pageY:e})=>{const{sx:s,sy:i,ex:n,ey:a,px:h,py:r}=this.points;if(this.moving){const n=t-h+s,a=e-r+i;return this.ctx.putImageData(this.canvasData[1],0,0),void this.ctx.putImageData(this.canvasData[2],n,a)}!1!==this.canDraw&&(this.points.mx=t,this.points.my=e,this.draw(t,e,this.points),this.points.px=this.points.mx,this.points.py=this.points.my)},this.onMouseLeave=()=>{this.canDraw=!1,this.moving=!1},this.onMoveSelect=()=>{},this.withinSelectScope=(t,e)=>{const{brush:s}=this.pencil.options;if(!this.hasSelect||s!=h.select)return!1;const{sx:i,sy:n,ex:a,ey:r}=this.points;return t>=i&&t<=a&&e>=n&&e<=r},this.canvasRef=i.createRef()}get canvas(){return this.canvasRef.current}get prevHistory(){return this.historys.pop()??{history:null}}componentDidMount(){this.ctx=this.canvas.getContext("2d"),this.pencil=new class{constructor(t,e){this.defaults={x:0,y:0,width:0,height:0,fill:!1,r:0,lineWidth:1,color:"#f00",brush:h.rect},this.options={},this.ctx=void 0,this.ctx=t,this.options=Object.assign(this.defaults,e)}setOptions(t={}){return Object.assign(this.options,t)}drawCircle({x:t=0,y:e=0,r:s=1,fill:i,color:n}=this.defaults){this.ctx.beginPath(),this.ctx.arc(t,e,s,0,2*Math.PI,!0),this.renderShape()}drawRect({x:t,y:e,width:s,height:i,fill:n,color:a}){this.ctx.beginPath(),this.ctx.rect(t,e,s,i),this.renderShape()}drawLine({x:t,y:e,xEnd:s,yEnd:i,color:n,lineWidth:a=1}){this.ctx.beginPath(),this.ctx.lineWidth=a,this.ctx.moveTo(t,e),this.ctx.lineTo(s,i),this.ctx.strokeStyle=n??"#f00",this.ctx.stroke(),this.ctx.closePath()}drawEllipse({x:t,y:e,xEnd:s,yEnd:i,color:n,fill:a,lineWidth:h=1}){this.ctx.lineWidth=h,this.ctx.beginPath(),this.ctx.ellipse(t,e,s,i,0,0,2*Math.PI),this.renderShape()}clear(t,e,s,i){this.ctx.clearRect(t,e,s,i)}renderShape({color:t="#000",fill:e=!1,lineWidth:s}=this.options){this.ctx.lineWidth=s,e?(this.ctx.fillStyle=t,this.ctx.fill()):(this.ctx.strokeStyle=t,this.ctx.stroke())}}(this.ctx),this.props.keydown.subscribe((t=>{t.defaultPrevented||(this.keyboard=t.key,t.shiftKey&&this.initBrushSetting())})),this.props.keyup.subscribe((t=>{t.key===r&&(this.keyboard="",this.initBrushSetting())}))}initBrushSetting(){const{brush:t}=this.pencil.options;t!=h.line?t!=h.curve?t!=h.select?t!=h.rect?t!=h.circle?this.draw=this.drawLine:this.draw=this.keyboard===r?this.drawCircle:this.drawEllipse:this.draw=this.keyboard===r?this.drawSquare:this.drawRect:this.draw=this.drawSelect:this.draw=this.keyboard===r?this.drawLine:this.drawCurve:this.draw=this.drawLine}saveHistory(){const{sx:t,sy:e,ex:s,ey:i}=this.points;s===t&&i===e||(this.canvasData[1]=this.getCanvasData(),this.historys.push({history:this.canvasData[1]}))}getCanvasData(t=0,e=0,{width:s,height:i}=this.props){return this.ctx.getImageData(t,e,s,i)}drawEllipse(t,e,{sx:s,sy:i}){const[n,a]=[s,i],[h,r]=[t-n,e-a];this.restoreCanvas(),this.pencil.drawEllipse({x:n,y:a,xEnd:h,yEnd:r})}drawCircle(t,e,{sx:s,sy:i}){const[n,a]=[s,i],h=Math.abs(t-n);this.restoreCanvas(),this.pencil.drawCircle({x:n,y:a,r:h})}drawCurve(t,e,{px:s,py:i}){const[n,a]=[s,i];this.pencil.drawLine({x:n,y:a,xEnd:t,yEnd:e})}drawLine(t,e,{sx:s,sy:i}){const[n,a]=[s,i];this.restoreCanvas(),this.pencil.drawLine({x:n,y:a,xEnd:t,yEnd:e})}drawSelect(t,e,{sx:s,sy:i}){this.ctx.save(),this.ctx.setLineDash([1,3]),this.ctx.lineWidth=1,this.drawRect(t,e,{sx:s,sy:i}),this.hasSelect=!0,this.ctx.restore()}drawRect(t,e,{sx:s,sy:i}){const[n,a]=[s,i],h=t-n,r=e?e-a:h;this.restoreCanvas(),this.pencil.drawRect({x:n,y:a,width:h,height:r})}drawSquare(t,e,{}){const s=Math.max(t,e);this.drawRect(s,null,this.points)}restoreCanvas(){this.pencil.clear(0,0,this.props.width,this.props.height),this.ctx.putImageData(this.canvasData[0],0,0)}render(){return i.createElement(i.Fragment,null,i.createElement(m,{brushChange:this.onBrushChange,onCancel:this.onCancel,download:this.onDownload}),i.createElement("canvas",b({ref:this.canvasRef},this.props,{onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onMouseMove:this.onMouseMove,onMouseLeave:this.onMouseLeave}),"您的浏览器版本不支持"))}}const f=C;var k=s(399);v()(k.Z,{insert:"head",singleton:!1}),k.Z.locals;var E=s(623);class S extends i.Component{constructor(...t){super(...t),this.state={width:0,height:0},this.keydownSub=new E.xQ,this.keyupSub=new E.xQ}componentDidMount(){let{clientHeight:t,clientWidth:e}=document.body;const s={width:e,height:t};this.props.changeClient(s),this.setState(s),document.addEventListener("keydown",(t=>this.keydownSub.next(t))),document.addEventListener("keyup",(t=>this.keyupSub.next(t)))}render(){return i.createElement(f,{width:this.state.width,height:this.state.height,keydown:this.keydownSub,keyup:this.keyupSub})}}const D=(0,a.$j)(null,(t=>({changeClient:(e,s)=>{t({type:e,payload:s})}})))(S);var M=s(890);const P={width:500,height:500},R=(0,M.MT)((function(t=P,{type:e,payload:s}){switch(e){case"UPDATE_CLIENT":return Object.assign({},t,{...s});default:return t}}));n.render(i.createElement(a.zt,{store:R},i.createElement(D,null)),document.getElementById("app"))},399:(t,e,s)=>{s.d(e,{Z:()=>r});var i=s(15),n=s.n(i),a=s(645),h=s.n(a)()(n());h.push([t.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const r=h},728:(t,e,s)=>{s.d(e,{Z:()=>r});var i=s(15),n=s.n(i),a=s(645),h=s.n(a)()(n());h.push([t.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const r=h},661:(t,e,s)=>{s.d(e,{Z:()=>r});var i=s(15),n=s.n(i),a=s(645),h=s.n(a)()(n());h.push([t.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const r=h}},e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={id:i,loaded:!1,exports:{}};return t[i](n,n.exports,s),n.loaded=!0,n.exports}s.m=t,s.x=t=>{},s.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={179:0},e=[[488,592]],i=t=>{},n=(n,a)=>{for(var h,r,[o,c,l,d]=a,p=0,u=[];p<o.length;p++)r=o[p],s.o(t,r)&&t[r]&&u.push(t[r][0]),t[r]=0;for(h in c)s.o(c,h)&&(s.m[h]=c[h]);for(l&&l(s),n&&n(a);u.length;)u.shift()();return d&&e.push.apply(e,d),i()},a=self.webpackChunkpainter=self.webpackChunkpainter||[];function h(){for(var i,n=0;n<e.length;n++){for(var a=e[n],h=!0,r=1;r<a.length;r++){var o=a[r];0!==t[o]&&(h=!1)}h&&(e.splice(n--,1),i=s(s.s=a[0]))}return 0===e.length&&(s.x(),s.x=t=>{}),i}a.forEach(n.bind(null,0)),a.push=n.bind(null,a.push.bind(a));var r=s.x;s.x=()=>(s.x=r||(t=>{}),(i=h)())})(),s.x()})();
//# sourceMappingURL=main.js.map